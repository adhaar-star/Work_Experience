<?php
use \App\Models\Helper;
?>
<?php $__env->startSection('content'); ?>
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">

      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"><?= $page_title ?> <span class="pull-right hidden-xs"><a href="javascript:;" class="btn btn-default"><i class="fa fa-plus"></i> Save</a> </span></h3>

      </div>
      <div class="panel-body">

          <form action="<?= Helper::adminUrl('store/save') ?>" method="post" enctype="multipart/form-data" class="form-horizontal">
              <?php echo e(csrf_field()); ?>


              <?php if(!empty($store->storeId)): ?> 
                <input type="hidden" name="storeId" value="<?php echo e($store->storeId); ?>">
              <?php endif; ?>
              <div class="col-sm-12">
                <p class="error">All fields marked in asterisk (*) are mandatory to be filled.</p>

                <?= Helper::alert() ?>
                                      
                   <div class="form-group  <?php echo e($errors->has('storeName') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">Store Name <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <input type="text" name="storeName" value="<?php echo e(Input::old('storeName', $store->storeName)); ?>" class="form-control" required>
                        <div class="help-block"><?php echo e($errors->first('storeName')); ?></div>
                      </div>
                  </div>

                 

                   <div class="form-group  <?php echo e($errors->has('storeImage') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">Store Image <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <input type="file" name="storeImage" class="form-control">
                      <div class="help-block field-info">Image resolution should be 1:1 (Minimum resolution: 1000x1000)</div>
                      <div class="help-block"><?php echo e($errors->first('storeImage')); ?></div>
                      </div>
                      <div class="col-sm-12">
                      <?php if(!empty($store->storeImage)): ?>
                      <img src="<?php echo e($store->storeImage); ?>" width="100" alt="<?php echo e($store->storeName); ?>">
                      <?php endif; ?>
                      </div>
                  </div>

                   <div class="form-group  <?php echo e($errors->has('storeDescription') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">Store Description <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <textarea name="storeDescription" class="form-control"><?php echo e(Input::old('storeDescription', $store->storeDescription)); ?></textarea>
                        <div class="help-block"><?php echo e($errors->first('storeDescription')); ?></div>
                      </div>
                  </div>

                   <div class="form-group  <?php echo e($errors->has('address') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">Address <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <input type="text" name="address" value="<?php echo e(Input::old('address', $store->address)); ?>" class="form-control" id="address" onfocus="geolocate()" required>
                        <div class="help-block"><?php echo e($errors->first('address')); ?></div>
                      </div>
                  </div>

                   <div class="form-group  <?php echo e($errors->has('city') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">City <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <input type="text" name="city" id="locality" value="<?php echo e(Input::old('city', $store->city)); ?>" class="form-control" required>
                        <div class="help-block"><?php echo e($errors->first('city')); ?></div>
                      </div>
                  </div>

                   <div class="form-group  <?php echo e($errors->has('state') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">State <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <input type="text" name="state" id="administrative_area_level_1" value="<?php echo e(Input::old('state', $store->state)); ?>" class="form-control" required>
                        <div class="help-block"><?php echo e($errors->first('state')); ?></div>
                      </div>
                  </div>

                   <div class="form-group  <?php echo e($errors->has('lat') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">Lat <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <input type="text" name="lat" id="lat" value="<?php echo e(Input::old('lat', $store->lat)); ?>" class="form-control" required>
                        <div class="help-block"><?php echo e($errors->first('lat')); ?></div>
                      </div>
                  </div>

                   <div class="form-group  <?php echo e($errors->has('lng') ? 'has-error' : ''); ?>">
                       <label class="col-sm-12">Lng <i class="error">*</i></label>
                       <div class="col-sm-12">
                       <input type="text" name="lng" id="lng" value="<?php echo e(Input::old('lng', $store->lng)); ?>" class="form-control" required>
                        <div class="help-block"><?php echo e($errors->first('lng')); ?></div>
                      </div>
                  </div>

            

          <div class="form-group">
            <div class="col-sm-12">
              <button class="btn btn-default"><i class="fa fa-plus"></i> Save</button>
          </div>
      </div>

  </div>
</form>
</div>
</div>
</div>
</div>
<?php $__env->stopSection(); ?>


<?php $__env->startSection('after_footer'); ?>
 <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>

<script>
  var placeSearch, autocomplete;

    var componentForm = {
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'short_name',
        postal_code: 'short_name'
    };


   function initialize() {
        // Create the autocomplete object, restricting the search
        // to geographical location types.
        autocomplete = new google.maps.places.Autocomplete(
                /** @type    {HTMLInputElement} */(document.getElementById('address')),
                //types: ['(cities)'],
                { componentRestrictions: {country: "in"}});
        // When the user selects an address from the dropdown,
        // populate the address fields in the form.
        google.maps.event.addListener(autocomplete, 'place_changed', function() {
            fillInAddress();
        });
    }

      function geolocate() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
              var geolocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
              };
              var circle = new google.maps.Circle({
                center: geolocation,
                radius: position.coords.accuracy
              });
              autocomplete.setBounds(circle.getBounds());
            });
        }
    }

    function fillInAddress() {

      var place = autocomplete.getPlace();
      var lat = place.geometry.location.lat(),
          lng = place.geometry.location.lng();

 
      for (var i = 0; i < place.address_components.length; i++) {
          var addressType = place.address_components[i].types[0];
          if (componentForm[addressType]) {
            var val = place.address_components[i][componentForm[addressType]];
            document.getElementById(addressType).value = val;
          }
      }

      $("#lat").val(lat);
      $("#lng").val(lng);

    }

    $(function(){
        
        initialize();
        
    });


</script>

<?php $__env->stopSection(); ?>